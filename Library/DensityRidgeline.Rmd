---
pagetitle: "Density Plots: Ridgelines by group"
author: ""
date: ""
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview

Create a group of Ridgeline density plots comparing distributions of health expenditures by timing and treatment status. 

```{r DensityRidgeline, fig.path = '../docs/figure/', warning = FALSE}
# Install and load packages ---------------
packages <- c(
  "tidyverse",
  "haven",
  "ggridges"
)

# Change to install = TRUE to install the required packages
pacman::p_load(packages, character.only = TRUE, install = FALSE)
```

# Data

This graph comes from Gertler, Paul J.; Martinez, Sebastian; Premand, Patrick; Rawlings, Laura B.; Vermeersch, Christel M. J.. 2016. "Impact Evaluation in Practice, Second Edition" Washington, DC: Inter-American Development Bank and World Bank. 

https://openknowledge.worldbank.org/handle/10986/25030

- `household_identifier`: Household identifier
- `treatment_locality`: Timing variable (pre/post treatment)
- `eligible`: Identifier for households eligible for program of interest
- `round`: Timing (baseline or follow-up) identifier
- `health_expenditures`: Annualized out of pocket health expenditures

- Unit of Observation: Households

```{r DensityRidgeline, fig.path = '../docs/figure/', warning = FALSE}
# Load an example dataset ---------------
data <- read_dta("https://github.com/worldbank/r-econ-visual-library/raw/master/Library/Data/evaluation.dta")

# Printing the first five rows of the data to visualize its structure before data wrangling
head(data)
```

```{r DensityRidgeline, fig.path = '../docs/figure/', warning = FALSE}
# Data wrangling ---------------
analysis_data <- data %>%
  filter(eligible == 1) %>% # Only keep eligible observations 
  mutate(group = interaction(round, treatment_locality), # Create variable uniquely identify by round & treatment_locality 
         group = recode_factor(group, # Label group variable accordingly 
                               `0.0` = "Before & Control",
                               `0.1` = "Before & Treated",
                               `1.0` = "After & Control",
                               `1.1` = "After & Treated"
                               ))  # Using backticks to specify the name of observations written in numbers

# Printing the first five rows of the data to visualize its structure after data wrangling
head(data)
```

```{r DensityRidgeline, fig.path = '../docs/figure/', warning = FALSE}
# Create a graph ---------------
ggplot(analysis_data, aes(x = health_expenditures, y = group)) +
  stat_density_ridges(alpha = 0.6, bandwidth = 0.2) + 
  theme_ridges() + # Set theme to ridgelines 
  labs(
    x = "Health Expenditures ($)",
    y = "Group"
  ) +
  xlim(c(0, 50)) +
  theme(legend.position = "none") # Setting the legend.position to none to get rid of the legend

```


